/**
 * Auto-generated migration SQL for tenant provisioning
 *
 * DO NOT EDIT MANUALLY - regenerate with:
 *   bun packages/db/scripts/generate-init-sql.ts
 *
 * Generated: 2026-02-09T13:00:30.665Z
 * Migrations: 2
 */

export interface Migration {
  /** Migration name/tag (e.g., "0000_initial") */
  tag: string
  /** Timestamp when migration was created */
  when: number
  /** SHA-256 hash of SQL content (for drizzle tracking) */
  hash: string
  /** Raw SQL content */
  sql: string
}

/**
 * All migrations in order, ready to be applied to a new tenant database.
 * Each migration's SQL may contain multiple statements separated by
 * '--> statement-breakpoint' markers.
 */
export const MIGRATIONS: Migration[] = [
  {
    tag: '0000_initial',
    when: 1770636770602,
    hash: '74a16291d61f63bfef0d018f7288b2faa3615fed2a9dc5e799ef055dfe804e96',
    sql: 'CREATE TABLE "account" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"account_id" text NOT NULL,\n\t"provider_id" text NOT NULL,\n\t"user_id" uuid NOT NULL,\n\t"access_token" text,\n\t"refresh_token" text,\n\t"id_token" text,\n\t"access_token_expires_at" timestamp with time zone,\n\t"refresh_token_expires_at" timestamp with time zone,\n\t"scope" text,\n\t"password" text,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "invitation" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"email" text NOT NULL,\n\t"name" text,\n\t"role" text,\n\t"status" text DEFAULT \'pending\' NOT NULL,\n\t"expires_at" timestamp with time zone NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"last_sent_at" timestamp with time zone,\n\t"inviter_id" uuid NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "one_time_token" (\n\t"id" text PRIMARY KEY NOT NULL,\n\t"token" text NOT NULL,\n\t"user_id" uuid NOT NULL,\n\t"expires_at" timestamp with time zone NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "principal" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"user_id" uuid NOT NULL,\n\t"role" text DEFAULT \'member\' NOT NULL,\n\t"type" text DEFAULT \'user\' NOT NULL,\n\t"display_name" text,\n\t"service_metadata" jsonb,\n\t"created_at" timestamp with time zone NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "session" (\n\t"id" text PRIMARY KEY NOT NULL,\n\t"expires_at" timestamp with time zone NOT NULL,\n\t"token" text NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone NOT NULL,\n\t"ip_address" text,\n\t"user_agent" text,\n\t"user_id" uuid NOT NULL,\n\tCONSTRAINT "session_token_unique" UNIQUE("token")\n);\n--> statement-breakpoint\nCREATE TABLE "settings" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"name" text NOT NULL,\n\t"slug" text NOT NULL,\n\t"logo_key" text,\n\t"favicon_key" text,\n\t"header_logo_key" text,\n\t"created_at" timestamp with time zone NOT NULL,\n\t"metadata" text,\n\t"auth_config" text,\n\t"portal_config" text,\n\t"branding_config" text,\n\t"custom_css" text,\n\t"developer_config" text,\n\t"header_display_mode" text DEFAULT \'logo_and_name\',\n\t"header_display_name" text,\n\t"setup_state" text,\n\tCONSTRAINT "settings_slug_unique" UNIQUE("slug")\n);\n--> statement-breakpoint\nCREATE TABLE "user" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"name" text NOT NULL,\n\t"email" text NOT NULL,\n\t"email_verified" boolean DEFAULT false NOT NULL,\n\t"image" text,\n\t"image_key" text,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"metadata" text\n);\n--> statement-breakpoint\nCREATE TABLE "verification" (\n\t"id" text PRIMARY KEY NOT NULL,\n\t"identifier" text NOT NULL,\n\t"value" text NOT NULL,\n\t"expires_at" timestamp with time zone NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "boards" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"slug" text NOT NULL,\n\t"name" text NOT NULL,\n\t"description" text,\n\t"is_public" boolean DEFAULT true NOT NULL,\n\t"settings" jsonb DEFAULT \'{}\'::jsonb NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"deleted_at" timestamp with time zone,\n\tCONSTRAINT "boards_slug_unique" UNIQUE("slug")\n);\n--> statement-breakpoint\nCREATE TABLE "roadmaps" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"slug" text NOT NULL,\n\t"name" text NOT NULL,\n\t"description" text,\n\t"is_public" boolean DEFAULT true NOT NULL,\n\t"position" integer DEFAULT 0 NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"deleted_at" timestamp with time zone,\n\tCONSTRAINT "roadmaps_slug_unique" UNIQUE("slug")\n);\n--> statement-breakpoint\nCREATE TABLE "tags" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"name" text NOT NULL,\n\t"color" text DEFAULT \'#6b7280\' NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"deleted_at" timestamp with time zone,\n\tCONSTRAINT "tags_name_unique" UNIQUE("name")\n);\n--> statement-breakpoint\nCREATE TABLE "post_statuses" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"name" text NOT NULL,\n\t"slug" text NOT NULL,\n\t"color" text DEFAULT \'#6b7280\' NOT NULL,\n\t"category" text DEFAULT \'active\' NOT NULL,\n\t"position" integer DEFAULT 0 NOT NULL,\n\t"show_on_roadmap" boolean DEFAULT false NOT NULL,\n\t"is_default" boolean DEFAULT false NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"deleted_at" timestamp with time zone,\n\tCONSTRAINT "post_statuses_slug_unique" UNIQUE("slug")\n);\n--> statement-breakpoint\nCREATE TABLE "comment_edit_history" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"comment_id" uuid NOT NULL,\n\t"editor_principal_id" uuid NOT NULL,\n\t"previous_content" text NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "comment_reactions" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"comment_id" uuid NOT NULL,\n\t"principal_id" uuid NOT NULL,\n\t"emoji" text NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "comments" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"post_id" uuid NOT NULL,\n\t"parent_id" uuid,\n\t"principal_id" uuid NOT NULL,\n\t"content" text NOT NULL,\n\t"is_team_member" boolean DEFAULT false NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"deleted_at" timestamp with time zone\n);\n--> statement-breakpoint\nCREATE TABLE "post_edit_history" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"post_id" uuid NOT NULL,\n\t"editor_principal_id" uuid NOT NULL,\n\t"previous_title" text NOT NULL,\n\t"previous_content" text NOT NULL,\n\t"previous_content_json" jsonb,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "post_notes" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"post_id" uuid NOT NULL,\n\t"principal_id" uuid NOT NULL,\n\t"content" text NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "post_roadmaps" (\n\t"post_id" uuid NOT NULL,\n\t"roadmap_id" uuid NOT NULL,\n\t"position" integer DEFAULT 0 NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "post_tags" (\n\t"post_id" uuid NOT NULL,\n\t"tag_id" uuid NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "posts" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"board_id" uuid NOT NULL,\n\t"title" text NOT NULL,\n\t"content" text NOT NULL,\n\t"content_json" jsonb,\n\t"principal_id" uuid NOT NULL,\n\t"status_id" uuid,\n\t"owner_principal_id" uuid,\n\t"vote_count" integer DEFAULT 0 NOT NULL,\n\t"comment_count" integer DEFAULT 0 NOT NULL,\n\t"official_response" text,\n\t"official_response_principal_id" uuid,\n\t"official_response_at" timestamp with time zone,\n\t"pinned_comment_id" uuid,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"deleted_at" timestamp with time zone,\n\t"deleted_by_principal_id" uuid,\n\t"moderation_state" text DEFAULT \'published\' NOT NULL,\n\t"canonical_post_id" uuid,\n\t"merged_at" timestamp with time zone,\n\t"merged_by_principal_id" uuid,\n\t"search_vector" "tsvector" GENERATED ALWAYS AS (setweight(to_tsvector(\'english\', coalesce(title, \'\')), \'A\') || setweight(to_tsvector(\'english\', coalesce(content, \'\')), \'B\')) STORED,\n\t"embedding" vector(1536),\n\t"embedding_model" text,\n\t"embedding_updated_at" timestamp with time zone,\n\tCONSTRAINT "vote_count_non_negative" CHECK (vote_count >= 0),\n\tCONSTRAINT "comment_count_non_negative" CHECK (comment_count >= 0)\n);\n--> statement-breakpoint\nCREATE TABLE "votes" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"post_id" uuid NOT NULL,\n\t"principal_id" uuid NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "integration_event_mappings" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"integration_id" uuid NOT NULL,\n\t"event_type" varchar(100) NOT NULL,\n\t"action_type" varchar(50) NOT NULL,\n\t"action_config" jsonb DEFAULT \'{}\'::jsonb NOT NULL,\n\t"filters" jsonb,\n\t"enabled" boolean DEFAULT true NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\tCONSTRAINT "mapping_unique" UNIQUE("integration_id","event_type","action_type")\n);\n--> statement-breakpoint\nCREATE TABLE "integration_platform_credentials" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"integration_type" varchar(50) NOT NULL,\n\t"secrets" text NOT NULL,\n\t"configured_by_principal_id" uuid,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\tCONSTRAINT "platform_cred_type_unique" UNIQUE("integration_type")\n);\n--> statement-breakpoint\nCREATE TABLE "integrations" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"integration_type" varchar(50) NOT NULL,\n\t"status" varchar(20) DEFAULT \'pending\' NOT NULL,\n\t"secrets" text,\n\t"config" jsonb DEFAULT \'{}\'::jsonb NOT NULL,\n\t"connected_by_principal_id" uuid,\n\t"connected_at" timestamp with time zone,\n\t"last_sync_at" timestamp with time zone,\n\t"last_error" text,\n\t"last_error_at" timestamp with time zone,\n\t"error_count" integer DEFAULT 0 NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\tCONSTRAINT "integration_type_unique" UNIQUE("integration_type"),\n\tCONSTRAINT "error_count_non_negative" CHECK (error_count >= 0)\n);\n--> statement-breakpoint\nCREATE TABLE "changelog_entries" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"title" text NOT NULL,\n\t"content" text NOT NULL,\n\t"content_json" jsonb,\n\t"principal_id" uuid,\n\t"published_at" timestamp with time zone,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"deleted_at" timestamp with time zone\n);\n--> statement-breakpoint\nCREATE TABLE "changelog_entry_posts" (\n\t"changelog_entry_id" uuid NOT NULL,\n\t"post_id" uuid NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "in_app_notifications" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"principal_id" uuid NOT NULL,\n\t"type" varchar(50) NOT NULL,\n\t"title" varchar(255) NOT NULL,\n\t"body" text,\n\t"post_id" uuid,\n\t"comment_id" uuid,\n\t"metadata" jsonb,\n\t"read_at" timestamp with time zone,\n\t"archived_at" timestamp with time zone,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "notification_preferences" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"principal_id" uuid NOT NULL,\n\t"email_status_change" boolean DEFAULT true NOT NULL,\n\t"email_new_comment" boolean DEFAULT true NOT NULL,\n\t"email_muted" boolean DEFAULT false NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\tCONSTRAINT "notification_preferences_principal_id_unique" UNIQUE("principal_id")\n);\n--> statement-breakpoint\nCREATE TABLE "post_subscriptions" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"post_id" uuid NOT NULL,\n\t"principal_id" uuid NOT NULL,\n\t"reason" varchar(20) NOT NULL,\n\t"notify_comments" boolean DEFAULT true NOT NULL,\n\t"notify_status_changes" boolean DEFAULT true NOT NULL,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL\n);\n--> statement-breakpoint\nCREATE TABLE "unsubscribe_tokens" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"token" text NOT NULL,\n\t"principal_id" uuid NOT NULL,\n\t"post_id" uuid,\n\t"action" varchar(30) NOT NULL,\n\t"expires_at" timestamp with time zone NOT NULL,\n\t"used_at" timestamp with time zone,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\tCONSTRAINT "unsubscribe_tokens_token_unique" UNIQUE("token")\n);\n--> statement-breakpoint\nCREATE TABLE "post_sentiment" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"post_id" uuid NOT NULL,\n\t"sentiment" text NOT NULL,\n\t"confidence" real NOT NULL,\n\t"model" text NOT NULL,\n\t"processed_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"input_tokens" integer,\n\t"output_tokens" integer,\n\tCONSTRAINT "post_sentiment_post_id_unique" UNIQUE("post_id")\n);\n--> statement-breakpoint\nCREATE TABLE "api_keys" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"name" varchar(255) NOT NULL,\n\t"key_hash" varchar(64) NOT NULL,\n\t"key_prefix" varchar(12) NOT NULL,\n\t"created_by_id" uuid NOT NULL,\n\t"last_used_at" timestamp with time zone,\n\t"expires_at" timestamp with time zone,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"revoked_at" timestamp with time zone,\n\tCONSTRAINT "api_keys_key_hash_unique" UNIQUE("key_hash")\n);\n--> statement-breakpoint\nCREATE TABLE "webhooks" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"created_by_id" uuid NOT NULL,\n\t"url" text NOT NULL,\n\t"secret" text NOT NULL,\n\t"events" text[] NOT NULL,\n\t"board_ids" text[],\n\t"status" text DEFAULT \'active\' NOT NULL,\n\t"failure_count" integer DEFAULT 0 NOT NULL,\n\t"last_error" text,\n\t"last_triggered_at" timestamp with time zone,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"updated_at" timestamp with time zone DEFAULT now() NOT NULL,\n\t"deleted_at" timestamp with time zone\n);\n--> statement-breakpoint\nCREATE TABLE "post_external_links" (\n\t"id" uuid PRIMARY KEY NOT NULL,\n\t"post_id" uuid NOT NULL,\n\t"integration_id" uuid NOT NULL,\n\t"integration_type" varchar(50) NOT NULL,\n\t"external_id" text NOT NULL,\n\t"external_url" text,\n\t"created_at" timestamp with time zone DEFAULT now() NOT NULL,\n\tCONSTRAINT "post_external_links_type_external_id" UNIQUE("integration_type","external_id")\n);\n--> statement-breakpoint\nALTER TABLE "account" ADD CONSTRAINT "account_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "invitation" ADD CONSTRAINT "invitation_inviter_id_user_id_fk" FOREIGN KEY ("inviter_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "one_time_token" ADD CONSTRAINT "one_time_token_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "principal" ADD CONSTRAINT "principal_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "session" ADD CONSTRAINT "session_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "comment_edit_history" ADD CONSTRAINT "comment_edit_history_comment_id_comments_id_fk" FOREIGN KEY ("comment_id") REFERENCES "public"."comments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "comment_edit_history" ADD CONSTRAINT "comment_edit_history_editor_principal_id_principal_id_fk" FOREIGN KEY ("editor_principal_id") REFERENCES "public"."principal"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "comment_reactions" ADD CONSTRAINT "comment_reactions_comment_id_comments_id_fk" FOREIGN KEY ("comment_id") REFERENCES "public"."comments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "comment_reactions" ADD CONSTRAINT "comment_reactions_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "comments" ADD CONSTRAINT "comments_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "comments" ADD CONSTRAINT "comments_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE restrict ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_edit_history" ADD CONSTRAINT "post_edit_history_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_edit_history" ADD CONSTRAINT "post_edit_history_editor_principal_id_principal_id_fk" FOREIGN KEY ("editor_principal_id") REFERENCES "public"."principal"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_notes" ADD CONSTRAINT "post_notes_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_notes" ADD CONSTRAINT "post_notes_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE restrict ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_roadmaps" ADD CONSTRAINT "post_roadmaps_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_roadmaps" ADD CONSTRAINT "post_roadmaps_roadmap_id_roadmaps_id_fk" FOREIGN KEY ("roadmap_id") REFERENCES "public"."roadmaps"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_tags" ADD CONSTRAINT "post_tags_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_tags" ADD CONSTRAINT "post_tags_tag_id_tags_id_fk" FOREIGN KEY ("tag_id") REFERENCES "public"."tags"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "posts" ADD CONSTRAINT "posts_board_id_boards_id_fk" FOREIGN KEY ("board_id") REFERENCES "public"."boards"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "posts" ADD CONSTRAINT "posts_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE restrict ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "posts" ADD CONSTRAINT "posts_status_id_post_statuses_id_fk" FOREIGN KEY ("status_id") REFERENCES "public"."post_statuses"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "posts" ADD CONSTRAINT "posts_owner_principal_id_principal_id_fk" FOREIGN KEY ("owner_principal_id") REFERENCES "public"."principal"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "posts" ADD CONSTRAINT "posts_official_response_principal_id_principal_id_fk" FOREIGN KEY ("official_response_principal_id") REFERENCES "public"."principal"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "posts" ADD CONSTRAINT "posts_deleted_by_principal_id_principal_id_fk" FOREIGN KEY ("deleted_by_principal_id") REFERENCES "public"."principal"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "posts" ADD CONSTRAINT "posts_merged_by_principal_id_principal_id_fk" FOREIGN KEY ("merged_by_principal_id") REFERENCES "public"."principal"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "votes" ADD CONSTRAINT "votes_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "votes" ADD CONSTRAINT "votes_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "integration_event_mappings" ADD CONSTRAINT "event_mappings_integration_fk" FOREIGN KEY ("integration_id") REFERENCES "public"."integrations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "integration_platform_credentials" ADD CONSTRAINT "integration_platform_credentials_configured_by_principal_id_principal_id_fk" FOREIGN KEY ("configured_by_principal_id") REFERENCES "public"."principal"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "integrations" ADD CONSTRAINT "integrations_connected_by_principal_id_principal_id_fk" FOREIGN KEY ("connected_by_principal_id") REFERENCES "public"."principal"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "changelog_entries" ADD CONSTRAINT "changelog_entries_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "changelog_entry_posts" ADD CONSTRAINT "changelog_entry_posts_changelog_entry_id_changelog_entries_id_fk" FOREIGN KEY ("changelog_entry_id") REFERENCES "public"."changelog_entries"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "changelog_entry_posts" ADD CONSTRAINT "changelog_entry_posts_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "in_app_notifications" ADD CONSTRAINT "in_app_notifications_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "in_app_notifications" ADD CONSTRAINT "in_app_notifications_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "in_app_notifications" ADD CONSTRAINT "in_app_notifications_comment_id_comments_id_fk" FOREIGN KEY ("comment_id") REFERENCES "public"."comments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "notification_preferences" ADD CONSTRAINT "notification_preferences_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_subscriptions" ADD CONSTRAINT "post_subscriptions_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_subscriptions" ADD CONSTRAINT "post_subscriptions_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "unsubscribe_tokens" ADD CONSTRAINT "unsubscribe_tokens_principal_id_principal_id_fk" FOREIGN KEY ("principal_id") REFERENCES "public"."principal"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "unsubscribe_tokens" ADD CONSTRAINT "unsubscribe_tokens_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_sentiment" ADD CONSTRAINT "post_sentiment_post_id_posts_id_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "api_keys" ADD CONSTRAINT "api_keys_created_by_id_principal_id_fk" FOREIGN KEY ("created_by_id") REFERENCES "public"."principal"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "webhooks" ADD CONSTRAINT "webhooks_created_by_id_principal_id_fk" FOREIGN KEY ("created_by_id") REFERENCES "public"."principal"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_external_links" ADD CONSTRAINT "post_external_links_post_fk" FOREIGN KEY ("post_id") REFERENCES "public"."posts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "post_external_links" ADD CONSTRAINT "post_external_links_integration_fk" FOREIGN KEY ("integration_id") REFERENCES "public"."integrations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nCREATE INDEX "account_userId_idx" ON "account" USING btree ("user_id");--> statement-breakpoint\nCREATE INDEX "invitation_email_idx" ON "invitation" USING btree ("email");--> statement-breakpoint\nCREATE INDEX "invitation_email_status_idx" ON "invitation" USING btree ("email","status");--> statement-breakpoint\nCREATE UNIQUE INDEX "principal_user_idx" ON "principal" USING btree ("user_id");--> statement-breakpoint\nCREATE INDEX "principal_role_idx" ON "principal" USING btree ("role");--> statement-breakpoint\nCREATE INDEX "principal_type_idx" ON "principal" USING btree ("type");--> statement-breakpoint\nCREATE INDEX "session_userId_idx" ON "session" USING btree ("user_id");--> statement-breakpoint\nCREATE UNIQUE INDEX "user_email_idx" ON "user" USING btree ("email");--> statement-breakpoint\nCREATE INDEX "verification_identifier_idx" ON "verification" USING btree ("identifier");--> statement-breakpoint\nCREATE INDEX "boards_is_public_idx" ON "boards" USING btree ("is_public");--> statement-breakpoint\nCREATE INDEX "boards_deleted_at_idx" ON "boards" USING btree ("deleted_at");--> statement-breakpoint\nCREATE INDEX "roadmaps_position_idx" ON "roadmaps" USING btree ("position");--> statement-breakpoint\nCREATE INDEX "roadmaps_is_public_idx" ON "roadmaps" USING btree ("is_public");--> statement-breakpoint\nCREATE INDEX "roadmaps_deleted_at_idx" ON "roadmaps" USING btree ("deleted_at");--> statement-breakpoint\nCREATE INDEX "tags_deleted_at_idx" ON "tags" USING btree ("deleted_at");--> statement-breakpoint\nCREATE INDEX "post_statuses_position_idx" ON "post_statuses" USING btree ("category","position");--> statement-breakpoint\nCREATE INDEX "post_statuses_deleted_at_idx" ON "post_statuses" USING btree ("deleted_at");--> statement-breakpoint\nCREATE INDEX "comment_edit_history_comment_id_idx" ON "comment_edit_history" USING btree ("comment_id");--> statement-breakpoint\nCREATE INDEX "comment_edit_history_created_at_idx" ON "comment_edit_history" USING btree ("created_at");--> statement-breakpoint\nCREATE INDEX "comment_reactions_comment_id_idx" ON "comment_reactions" USING btree ("comment_id");--> statement-breakpoint\nCREATE INDEX "comment_reactions_principal_id_idx" ON "comment_reactions" USING btree ("principal_id");--> statement-breakpoint\nCREATE UNIQUE INDEX "comment_reactions_unique_idx" ON "comment_reactions" USING btree ("comment_id","principal_id","emoji");--> statement-breakpoint\nCREATE INDEX "comments_post_id_idx" ON "comments" USING btree ("post_id");--> statement-breakpoint\nCREATE INDEX "comments_parent_id_idx" ON "comments" USING btree ("parent_id");--> statement-breakpoint\nCREATE INDEX "comments_principal_id_idx" ON "comments" USING btree ("principal_id");--> statement-breakpoint\nCREATE INDEX "comments_created_at_idx" ON "comments" USING btree ("created_at");--> statement-breakpoint\nCREATE INDEX "comments_post_created_at_idx" ON "comments" USING btree ("post_id","created_at");--> statement-breakpoint\nCREATE INDEX "post_edit_history_post_id_idx" ON "post_edit_history" USING btree ("post_id");--> statement-breakpoint\nCREATE INDEX "post_edit_history_created_at_idx" ON "post_edit_history" USING btree ("created_at");--> statement-breakpoint\nCREATE INDEX "post_notes_post_id_idx" ON "post_notes" USING btree ("post_id");--> statement-breakpoint\nCREATE INDEX "post_notes_principal_id_idx" ON "post_notes" USING btree ("principal_id");--> statement-breakpoint\nCREATE INDEX "post_notes_created_at_idx" ON "post_notes" USING btree ("created_at");--> statement-breakpoint\nCREATE UNIQUE INDEX "post_roadmaps_pk" ON "post_roadmaps" USING btree ("post_id","roadmap_id");--> statement-breakpoint\nCREATE INDEX "post_roadmaps_post_id_idx" ON "post_roadmaps" USING btree ("post_id");--> statement-breakpoint\nCREATE INDEX "post_roadmaps_roadmap_id_idx" ON "post_roadmaps" USING btree ("roadmap_id");--> statement-breakpoint\nCREATE INDEX "post_roadmaps_position_idx" ON "post_roadmaps" USING btree ("roadmap_id","position");--> statement-breakpoint\nCREATE UNIQUE INDEX "post_tags_pk" ON "post_tags" USING btree ("post_id","tag_id");--> statement-breakpoint\nCREATE INDEX "post_tags_post_id_idx" ON "post_tags" USING btree ("post_id");--> statement-breakpoint\nCREATE INDEX "post_tags_tag_id_idx" ON "post_tags" USING btree ("tag_id");--> statement-breakpoint\nCREATE INDEX "posts_board_id_idx" ON "posts" USING btree ("board_id");--> statement-breakpoint\nCREATE INDEX "posts_status_id_idx" ON "posts" USING btree ("status_id");--> statement-breakpoint\nCREATE INDEX "posts_principal_id_idx" ON "posts" USING btree ("principal_id");--> statement-breakpoint\nCREATE INDEX "posts_owner_principal_id_idx" ON "posts" USING btree ("owner_principal_id");--> statement-breakpoint\nCREATE INDEX "posts_created_at_idx" ON "posts" USING btree ("created_at");--> statement-breakpoint\nCREATE INDEX "posts_vote_count_idx" ON "posts" USING btree ("vote_count");--> statement-breakpoint\nCREATE INDEX "posts_board_vote_idx" ON "posts" USING btree ("board_id","vote_count");--> statement-breakpoint\nCREATE INDEX "posts_board_created_at_idx" ON "posts" USING btree ("board_id","created_at");--> statement-breakpoint\nCREATE INDEX "posts_board_status_idx" ON "posts" USING btree ("board_id","status_id");--> statement-breakpoint\nCREATE INDEX "posts_principal_created_at_idx" ON "posts" USING btree ("principal_id","created_at");--> statement-breakpoint\nCREATE INDEX "posts_with_status_idx" ON "posts" USING btree ("status_id","vote_count") WHERE status_id IS NOT NULL;--> statement-breakpoint\nCREATE INDEX "posts_search_vector_idx" ON "posts" USING gin ("search_vector");--> statement-breakpoint\nCREATE INDEX "posts_deleted_at_idx" ON "posts" USING btree ("deleted_at");--> statement-breakpoint\nCREATE INDEX "posts_board_deleted_at_idx" ON "posts" USING btree ("board_id","deleted_at");--> statement-breakpoint\nCREATE INDEX "posts_moderation_state_idx" ON "posts" USING btree ("moderation_state");--> statement-breakpoint\nCREATE INDEX "posts_pinned_comment_id_idx" ON "posts" USING btree ("pinned_comment_id");--> statement-breakpoint\nCREATE INDEX "posts_canonical_post_id_idx" ON "posts" USING btree ("canonical_post_id");--> statement-breakpoint\nCREATE INDEX "votes_post_id_idx" ON "votes" USING btree ("post_id");--> statement-breakpoint\nCREATE UNIQUE INDEX "votes_principal_post_idx" ON "votes" USING btree ("post_id","principal_id");--> statement-breakpoint\nCREATE INDEX "votes_principal_id_idx" ON "votes" USING btree ("principal_id");--> statement-breakpoint\nCREATE INDEX "votes_principal_created_at_idx" ON "votes" USING btree ("principal_id","created_at");--> statement-breakpoint\nCREATE INDEX "idx_event_mappings_lookup" ON "integration_event_mappings" USING btree ("integration_id","event_type","enabled");--> statement-breakpoint\nCREATE INDEX "idx_integrations_type_status" ON "integrations" USING btree ("integration_type","status");--> statement-breakpoint\nCREATE INDEX "changelog_published_at_idx" ON "changelog_entries" USING btree ("published_at");--> statement-breakpoint\nCREATE INDEX "changelog_principal_id_idx" ON "changelog_entries" USING btree ("principal_id");--> statement-breakpoint\nCREATE INDEX "changelog_deleted_at_idx" ON "changelog_entries" USING btree ("deleted_at");--> statement-breakpoint\nCREATE UNIQUE INDEX "changelog_entry_posts_pk" ON "changelog_entry_posts" USING btree ("changelog_entry_id","post_id");--> statement-breakpoint\nCREATE INDEX "changelog_entry_posts_changelog_id_idx" ON "changelog_entry_posts" USING btree ("changelog_entry_id");--> statement-breakpoint\nCREATE INDEX "changelog_entry_posts_post_id_idx" ON "changelog_entry_posts" USING btree ("post_id");--> statement-breakpoint\nCREATE INDEX "in_app_notifications_principal_created_idx" ON "in_app_notifications" USING btree ("principal_id","created_at");--> statement-breakpoint\nCREATE INDEX "in_app_notifications_principal_unread_idx" ON "in_app_notifications" USING btree ("principal_id") WHERE read_at IS NULL AND archived_at IS NULL;--> statement-breakpoint\nCREATE INDEX "in_app_notifications_post_idx" ON "in_app_notifications" USING btree ("post_id");--> statement-breakpoint\nCREATE UNIQUE INDEX "post_subscriptions_unique" ON "post_subscriptions" USING btree ("post_id","principal_id");--> statement-breakpoint\nCREATE INDEX "post_subscriptions_principal_idx" ON "post_subscriptions" USING btree ("principal_id");--> statement-breakpoint\nCREATE INDEX "post_subscriptions_post_idx" ON "post_subscriptions" USING btree ("post_id");--> statement-breakpoint\nCREATE INDEX "post_subscriptions_post_comments_idx" ON "post_subscriptions" USING btree ("post_id") WHERE notify_comments = true;--> statement-breakpoint\nCREATE INDEX "post_subscriptions_post_status_idx" ON "post_subscriptions" USING btree ("post_id") WHERE notify_status_changes = true;--> statement-breakpoint\nCREATE INDEX "unsubscribe_tokens_principal_idx" ON "unsubscribe_tokens" USING btree ("principal_id");--> statement-breakpoint\nCREATE INDEX "post_sentiment_processed_at_idx" ON "post_sentiment" USING btree ("processed_at");--> statement-breakpoint\nCREATE INDEX "post_sentiment_sentiment_idx" ON "post_sentiment" USING btree ("sentiment");--> statement-breakpoint\nCREATE INDEX "api_keys_created_by_id_idx" ON "api_keys" USING btree ("created_by_id");--> statement-breakpoint\nCREATE INDEX "api_keys_revoked_at_idx" ON "api_keys" USING btree ("revoked_at");--> statement-breakpoint\nCREATE INDEX "webhooks_status_idx" ON "webhooks" USING btree ("status");--> statement-breakpoint\nCREATE INDEX "webhooks_created_by_id_idx" ON "webhooks" USING btree ("created_by_id");--> statement-breakpoint\nCREATE INDEX "webhooks_deleted_at_idx" ON "webhooks" USING btree ("deleted_at");--> statement-breakpoint\nCREATE INDEX "post_external_links_post_id_idx" ON "post_external_links" USING btree ("post_id");--> statement-breakpoint\nCREATE INDEX "post_external_links_type_external_id_idx" ON "post_external_links" USING btree ("integration_type","external_id");',
  },
  {
    tag: '0001_loud_justice',
    when: 1770642015175,
    hash: '1112de23b4f5471cac363a9cc2f080009822cc9c4e31372d7bc35b82fab8ad15',
    sql: 'CREATE TABLE "jwks" (\n\t"id" text PRIMARY KEY NOT NULL,\n\t"public_key" text NOT NULL,\n\t"private_key" text NOT NULL,\n\t"created_at" timestamp with time zone NOT NULL,\n\t"expires_at" timestamp with time zone\n);\n--> statement-breakpoint\nCREATE TABLE "oauth_access_token" (\n\t"id" text PRIMARY KEY NOT NULL,\n\t"token" text,\n\t"client_id" text NOT NULL,\n\t"session_id" text,\n\t"user_id" uuid,\n\t"reference_id" text,\n\t"refresh_id" text,\n\t"expires_at" timestamp with time zone,\n\t"created_at" timestamp with time zone,\n\t"scopes" text[] NOT NULL,\n\tCONSTRAINT "oauth_access_token_token_unique" UNIQUE("token")\n);\n--> statement-breakpoint\nCREATE TABLE "oauth_client" (\n\t"id" text PRIMARY KEY NOT NULL,\n\t"client_id" text NOT NULL,\n\t"client_secret" text,\n\t"disabled" boolean DEFAULT false,\n\t"skip_consent" boolean,\n\t"enable_end_session" boolean,\n\t"scopes" text[],\n\t"user_id" uuid,\n\t"created_at" timestamp with time zone,\n\t"updated_at" timestamp with time zone,\n\t"name" text,\n\t"uri" text,\n\t"icon" text,\n\t"contacts" text[],\n\t"tos" text,\n\t"policy" text,\n\t"software_id" text,\n\t"software_version" text,\n\t"software_statement" text,\n\t"redirect_uris" text[] NOT NULL,\n\t"post_logout_redirect_uris" text[],\n\t"token_endpoint_auth_method" text,\n\t"grant_types" text[],\n\t"response_types" text[],\n\t"public" boolean,\n\t"type" text,\n\t"reference_id" text,\n\t"metadata" jsonb,\n\tCONSTRAINT "oauth_client_client_id_unique" UNIQUE("client_id")\n);\n--> statement-breakpoint\nCREATE TABLE "oauth_consent" (\n\t"id" text PRIMARY KEY NOT NULL,\n\t"client_id" text NOT NULL,\n\t"user_id" uuid,\n\t"reference_id" text,\n\t"scopes" text[] NOT NULL,\n\t"created_at" timestamp with time zone,\n\t"updated_at" timestamp with time zone\n);\n--> statement-breakpoint\nCREATE TABLE "oauth_refresh_token" (\n\t"id" text PRIMARY KEY NOT NULL,\n\t"token" text NOT NULL,\n\t"client_id" text NOT NULL,\n\t"session_id" text,\n\t"user_id" uuid NOT NULL,\n\t"reference_id" text,\n\t"expires_at" timestamp with time zone,\n\t"created_at" timestamp with time zone,\n\t"revoked" timestamp with time zone,\n\t"scopes" text[] NOT NULL\n);\n--> statement-breakpoint\nALTER TABLE "oauth_access_token" ADD CONSTRAINT "oauth_access_token_client_id_oauth_client_client_id_fk" FOREIGN KEY ("client_id") REFERENCES "public"."oauth_client"("client_id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_access_token" ADD CONSTRAINT "oauth_access_token_session_id_session_id_fk" FOREIGN KEY ("session_id") REFERENCES "public"."session"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_access_token" ADD CONSTRAINT "oauth_access_token_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_access_token" ADD CONSTRAINT "oauth_access_token_refresh_id_oauth_refresh_token_id_fk" FOREIGN KEY ("refresh_id") REFERENCES "public"."oauth_refresh_token"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_client" ADD CONSTRAINT "oauth_client_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_consent" ADD CONSTRAINT "oauth_consent_client_id_oauth_client_client_id_fk" FOREIGN KEY ("client_id") REFERENCES "public"."oauth_client"("client_id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_consent" ADD CONSTRAINT "oauth_consent_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_refresh_token" ADD CONSTRAINT "oauth_refresh_token_client_id_oauth_client_client_id_fk" FOREIGN KEY ("client_id") REFERENCES "public"."oauth_client"("client_id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_refresh_token" ADD CONSTRAINT "oauth_refresh_token_session_id_session_id_fk" FOREIGN KEY ("session_id") REFERENCES "public"."session"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint\nALTER TABLE "oauth_refresh_token" ADD CONSTRAINT "oauth_refresh_token_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;',
  },
]

/**
 * Schema version identifier (tag of last migration)
 */
export const SCHEMA_VERSION = '0001_loud_justice'

/**
 * Parse a migration SQL into individual statements.
 * Splits on drizzle-kit's breakpoint marker and filters empty/comment-only blocks.
 */
export function parseStatements(sql: string): string[] {
  return sql
    .split('--> statement-breakpoint')
    .map((s) => s.trim())
    .filter((s) => {
      if (s.length === 0) return false
      // Check if block contains any actual SQL (not just comments)
      const lines = s.split('\n')
      return lines.some((line) => {
        const trimmed = line.trim()
        return trimmed.length > 0 && !trimmed.startsWith('--')
      })
    })
}

/**
 * SQL to create the drizzle migrations tracking table.
 * This must be run before recording migrations.
 */
export const CREATE_MIGRATIONS_TABLE_SQL = `
CREATE SCHEMA IF NOT EXISTS drizzle;
CREATE TABLE IF NOT EXISTS drizzle.__drizzle_migrations (
  id SERIAL PRIMARY KEY,
  hash TEXT NOT NULL,
  created_at BIGINT NOT NULL
);
`

/**
 * SQL to insert a migration record.
 * Use with parameterized query: (hash, created_at)
 */
export const INSERT_MIGRATION_SQL = `
INSERT INTO drizzle.__drizzle_migrations (hash, created_at) VALUES ($1, $2)
`

/**
 * SQL to check which migrations have been applied.
 * Returns array of hashes.
 */
export const GET_APPLIED_MIGRATIONS_SQL = `
SELECT hash FROM drizzle.__drizzle_migrations
`

/**
 * Seed SQL for default post statuses.
 * Run after migrations to populate initial data.
 */
export const SEED_SQL = `INSERT INTO "post_statuses" ("id", "name", "slug", "color", "category", "position", "show_on_roadmap", "is_default", "created_at")
VALUES
  ('019c427d-4049-711b-9bc9-61e459860607', 'Open', 'open', '#3b82f6', 'active', 0, false, true, NOW()),
  ('019c427d-4049-711b-9bc9-69f43a36b197', 'Under Review', 'under_review', '#eab308', 'active', 1, false, false, NOW()),
  ('019c427d-4049-711b-9bc9-77a1525cb520', 'Planned', 'planned', '#a855f7', 'active', 2, true, false, NOW()),
  ('019c427d-4049-711b-9bc9-7a21c23991af', 'In Progress', 'in_progress', '#f97316', 'active', 3, true, false, NOW()),
  ('019c427d-4049-711b-9bc9-82f0086e7e0f', 'Complete', 'complete', '#22c55e', 'complete', 0, true, false, NOW()),
  ('019c427d-404a-711b-9bc9-880c35950e9e', 'Closed', 'closed', '#6b7280', 'closed', 0, false, false, NOW());`
